(()=>{"use strict";const t=1280,e=1250,n=200,i=300,a=200,o=200,r=235,s=335;let l=t,h=720;const c=(t,e)=>t-e,d=(t,e,a,o)=>{const r=(n*o-n)/2,s=(i*o-i)/2;t.lineWidth=5,t.strokeStyle="#ccc",t.beginPath(),t.rect(p(e-r),p(a-s),p(n*o),p(i*o)),t.stroke()},g=(e,n,i,a)=>e<t&&n>0&&i<720&&a>0,m=t=>t<a?u(t):t>1080?f(t):1,u=t=>Math.max((t+n)/400,.2),f=e=>Math.max((t-e)/n,.2),w=(t,e,n,i,a=200,o=300)=>{t.drawImage(e,p(n),p(i),p(a),p(o))},p=e=>l/t*e;const v="c0140031611f36da79a4001affaad896";let X=[];const b=()=>X.splice(Math.floor(Math.random()*X.length),1)[0],k=(t,e,n,i)=>new Promise(((a,o)=>{fetch(`https://api.themoviedb.org/3/genre/movie/list?api_key=${v}&language=en-UK`,{method:"GET"}).then((function(t){return t.ok?t.json():Promise.reject(t)})).then((o=>{X=o.genres;const r=[],s=[];r.push(b()),r.push(b()),r.push(b()),r.push(b());let l=0;r.forEach((o=>{var h,c,d,g,m;(h=o.id,c=void 0,d=void 0,g=void 0,m=function*(){const t=`https://api.themoviedb.org/3/discover/movie?with_genres=${h}&sort_by=popularity.desc&vote_count.gte=10&api_key=${v}`,e=yield fetch(t,{method:"GET"});return e.ok?e.json():Promise.reject(e)},new(g||(g=Promise))((function(t,e){function n(t){try{a(m.next(t))}catch(t){e(t)}}function i(t){try{a(m.throw(t))}catch(t){e(t)}}function a(e){var a;e.done?t(e.value):(a=e.value,a instanceof g?a:new g((function(t){t(a)}))).then(n,i)}a((m=m.apply(c,d||[])).next())}))).then((h=>{const{results:c}=h;c.length=10;const d=h.results.map(((a,o)=>{const{original_title:r,overview:s,backdrop_path:h,poster_path:c,release_date:d}=a;return{image:t,cardOriginalPositionX:o*(e+i),cardOriginalPositionY:l*(n+i),original_title:r,overview:s,backdrop_path:h,poster_path:c,release_date:d}})),g={id:o.id,cards:d,rowNumber:l,highlightedCard:0,translateX:0,animationStartTime:null,animationDirection:null,targetTranslateX:0,easingPosition:0,unfinishedMovementX:0};l+=1,s.push(g),s.length===r.length&&a(s)}))}))}))})),T=document.getElementById("canvas");T.width=t,T.height=720;const P=T.getContext("2d");let y,M,_,D,C=o,E=0,S=0,A=0,I=0,O=0,j=[];const x=[37,38,39,40];document.addEventListener("keydown",(t=>{t.preventDefault();const{keyCode:e}=t;if(!x.includes(e))return void console.log("invalid keycode");const n=j[S];switch(clearTimeout(y),y=window.setTimeout((()=>{}),2e3),e){case 37:n.highlightedCard>0&&(n.highlightedCard-=1,n.animationStartTime=Date.now(),n.animationDirection="left",n.unfinishedMovementX=n.unfinishedMovementX+n.targetTranslateX-n.translateX,n.targetTranslateX=n.highlightedCard*r,W());break;case 38:if(S>0){if("down"===D&&_&&_<175)return;S-=1,M=Date.now(),O=O+I-A,I=S*s,D="up",W()}break;case 39:n.highlightedCard<n.cards.length-1&&(n.highlightedCard+=1,n.animationStartTime=Date.now(),n.animationDirection="right",n.unfinishedMovementX=n.unfinishedMovementX+n.targetTranslateX-n.translateX,n.targetTranslateX=n.highlightedCard*r,W());break;case 40:if(S<3){if("up"===D&&_&&_<175)return;S+=1,M=Date.now(),O=O+I-A,I=S*s,D="down",W()}}})),(()=>{const t=(()=>{const t=new Image(n,i);return t.src="./defaultImage.jpg",t})();k(t,n,i,35).then((t=>{j=t,j=((t,e,r)=>(t.forEach(((s,l)=>{s.cards.forEach(((s,h)=>{const u=`https://image.tmdb.org/t/p/w200${s.poster_path}`;var f;(f=u,new Promise(((t,e)=>{const n=new Image;n.onload=()=>t(n),n.onerror=()=>e(new Error(`load ${f} fail`)),n.src=f}))).then((s=>{t[l].cards[h].image=s;const{translateX:u}=t[l],{cardOriginalPositionX:f,cardOriginalPositionY:w}=t[l].cards[h],v=c(f+a,u),X=c(w+o,r);((t,e,r,s)=>{if(g(r,r+n,s,s+i)){const l=r===a&&s===o,h=l?1.2:1,c=(n*h-n)/2,g=(i*h-i)/2,u=m(r);t.globalAlpha=u,t.drawImage(e,p(r-c),p(s-g),p(n*h),p(i*h)),l&&(t.globalAlpha=1,d(t,r,s,h))}})(e,s,v,X)}))}))})),t))(t,P,A),W()}))})();const $=t=>{C>o&&(A=I-s+(s+O)*t),C<o&&(A=I+s-(s-O)*t)},W=()=>{var t;if(P&&(t=>{t.clearRect(0,0,l,h)})(P),C=Math.round(S*s+o+O-A),M){const n=Date.now();_=n-M;let i=_/e;if(_>e||i>1)i=1,M=null,E=1,$(1),_=null;else{const e=(t=i,1-Math.pow(1-t,5));E=e,$(e)}}P&&((t,s,l,h,u,f,p)=>{let v=()=>{};for(let b=0;b<s.length;b++){const k=s[b];let{unfinishedMovementX:T,animationStartTime:P}=k;if(P){const t=Date.now()-P,n=Math.min(t/e,1),i=(X=n,1-Math.pow(1-X,5));k.easingPosition=i,"right"===k.animationDirection?k.translateX=k.targetTranslateX-r+(r+T)*i:"left"===k.animationDirection&&(k.translateX=k.targetTranslateX+r-(r-T)*i),n>=1&&(k.animationStartTime=null)}for(let e=0;e<s[b].cards.length;e++){const r=k.cards[e],{image:X,cardOriginalPositionX:P,cardOriginalPositionY:y}=r,M=c(P+T+a,k.translateX),_=c(y+o+h,u),{highlightedCard:D}=k;if(b===l&&e==D){let e=0;const{easingPosition:a}=s[b];e=a||(f?p:1);const o=.2*e+1,r=(n*o-n)/2,l=(i*o-i)/2;v=()=>{const e=m(M);t.globalAlpha=e,w(t,X,M-r,_-l,n*o,i*o),t.globalAlpha=1,d(t,M,_,o)}}else if(g(M,M+n,_,_+i)){const e=m(M);t.globalAlpha=e,w(t,X,M,_),t.globalAlpha=1}}}var X;v()})(P,j,S,O,A,M,E),P&&(t=>{t.lineWidth=3,t.strokeStyle="darkgreen",t.beginPath(),t.rect(0,0,l,l/1.7777777777777777),t.stroke()})(P),(()=>{var t;let e=!1;if(M)return!0;for(let n=0;n<4;n++)if(null===(t=j[n])||void 0===t?void 0:t.animationStartTime){e=!0;break}return e})()&&window.requestAnimationFrame(W)},Y=()=>{var t,e;t=window.innerWidth,e=window.innerHeight,h=e,l=t,T.height=window.innerHeight,T.width=window.innerWidth,M||(M=100,W())};window.onresize=Y,Y()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UStFLE9BQU82QyxXQUNqQmpFLElBQ0RBLEVBQXNCLElBQ3RCd0IsTUFJUkosT0FBTytDLFNBQVdMLEVBQ2xCQSxLIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2FudmFzLWNhcm91c2VsLy4vc3JjL2NvbnN0YW50cy50cyIsIndlYnBhY2s6Ly9jYW52YXMtY2Fyb3VzZWwvLi9zcmMvcmVuZGVyQ2FyZHMudHMiLCJ3ZWJwYWNrOi8vY2FudmFzLWNhcm91c2VsLy4vc3JjL2FwaS50cyIsIndlYnBhY2s6Ly9jYW52YXMtY2Fyb3VzZWwvLi9zcmMvbWFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCBXSURUSCA9IDEyODA7XG5jb25zdCBIRUlHSFQgPSA3MjA7XG5jb25zdCBBU1BFQ1RfUkFUSU8gPSBXSURUSCAvIEhFSUdIVDtcbmNvbnN0IEFOSU1BVElPTl9EVVJBVElPTiA9IDEyNTA7IC8vIHRpbWUgaW4gbXMgZm9yIGFuaW1hdGlvbiB0byBjb21wbGV0LFxuY29uc3QgSE9WRVJfVElNRU9VVCA9IDIwMDA7XG5jb25zdCBJTUFHRV9XSURUSCA9IDIwMDtcbmNvbnN0IElNQUdFX0hFSUdIVCA9IElNQUdFX1dJRFRIICogMS41O1xuY29uc3QgUEFERElORyA9IDM1O1xuY29uc3QgTlVNQkVSX09GX1JPV1MgPSA0O1xuY29uc3QgSU1BR0VTX1BFUl9ST1cgPSA3O1xuY29uc3QgSU1BR0VfU0NBTElOR19NQVggPSAwLjI7IC8vIGhvdyBtdWNoIGxhcmdlciB0aGFuIHRoZSBub24gc2NhbGVkIGltYWdlcyB0aGUgaGlnaGxpZ2h0ZWQgaW1hZ2UgYmVjb21lLFxuY29uc3QgVEFSR0VUX1BPU0lUSU9OX1ggPSAyMDA7IC8vIHRoZSBwb3NpdGlvbiBpbiBweCB0aGUgY2Fyb3VzZWwgdHJpZXMgdG8gbW92ZSB0aGUgaGlnaGxpZ2h0ZWQgY2FyZCB0b1xuY29uc3QgVEFSR0VUX1BPU0lUSU9OX1kgPSAyMDA7XG5jb25zdCBGUkFNRV9SQVRFID0gNDA7IC8vIHRhcmdldCByZWRyYXcgdGltZXIgc3BlZWQgaWYgdXNpbmcgc2V0VGltZW91dCBhbmQgbm90IHJlcXVlc3RBbmltYXRpb25GcmFtZVxuY29uc3QgU0lOR0xFX01PVkVfRElTVEFOQ0VfWCA9IElNQUdFX1dJRFRIICsgUEFERElORztcbmNvbnN0IFNJTkdMRV9NT1ZFX0RJU1RBTkNFX1kgPSBJTUFHRV9IRUlHSFQgKyBQQURESU5HO1xuY29uc3QgQUxQSEFfQU5JTUFUSU9OUyA9IHRydWU7XG5jb25zdCBMRUZUX0FMUEhBX0xJTUlUID0gVEFSR0VUX1BPU0lUSU9OX1ggKyBJTUFHRV9XSURUSDsgLy8gdGhlIHBvaW50IGF0IHdoaWNoIGFscGhhIHN0YXJ0cyBvbiBjYXJkcyBvZmYgdG8gdGhlIGxlZnRcbmNvbnN0IFVTRV9QT1JUQUxfU0NBTElORyA9IHRydWU7IC8vIHNjYWxlcyBpbWFnZXMgdG8gdGhlIHNpemUgb2YgdGhlIHBvcnRhbCAtIHdpbGwgaW1wYWN0IHBlcmZvcm1hbmNlIC0gcGVyaGFwcyBzb21lIGNhY2hpbmcgY291bGQgaW1wcm92ZSB0aGlzXG5jb25zdCBVU0VfUkVRVUVTVF9BTklNQVRJT05fRlJBTUUgPSB0cnVlOyAvLyBmb3Igc2xvdyBkZXZpY2VzIHdlIGNhbiB1c2Ugc2V0IHRpbWVvdXQgYW5kIHNldCB0aGUgRlJBTUVfUkFURSB0byBlcXVhbCB0aGUgQU5JTUFUSU9OX0RVUkFUSU9OIHRvIGVmZmVjdGl2ZWx5IGRpc2FibGUgYW5pbWF0aW9uc1xuY29uc3QgREVCVUcgPSB0cnVlO1xuXG5leHBvcnQge1xuICAgIFdJRFRILFxuICAgIEhFSUdIVCxcbiAgICBBU1BFQ1RfUkFUSU8sXG4gICAgQU5JTUFUSU9OX0RVUkFUSU9OLFxuICAgIEhPVkVSX1RJTUVPVVQsXG4gICAgSU1BR0VfV0lEVEgsXG4gICAgSU1BR0VfSEVJR0hULFxuICAgIFBBRERJTkcsXG4gICAgTlVNQkVSX09GX1JPV1MsXG4gICAgSU1BR0VTX1BFUl9ST1csXG4gICAgSU1BR0VfU0NBTElOR19NQVgsXG4gICAgVEFSR0VUX1BPU0lUSU9OX1gsXG4gICAgVEFSR0VUX1BPU0lUSU9OX1ksXG4gICAgRlJBTUVfUkFURSxcbiAgICBTSU5HTEVfTU9WRV9ESVNUQU5DRV9YLFxuICAgIFNJTkdMRV9NT1ZFX0RJU1RBTkNFX1ksXG4gICAgQUxQSEFfQU5JTUFUSU9OUyxcbiAgICBMRUZUX0FMUEhBX0xJTUlULFxuICAgIFVTRV9QT1JUQUxfU0NBTElORyxcbiAgICBVU0VfUkVRVUVTVF9BTklNQVRJT05fRlJBTUUsXG4gICAgREVCVUcsXG59O1xuIiwiaW1wb3J0IHtcbiAgICBBTklNQVRJT05fRFVSQVRJT04sXG4gICAgSU1BR0VfV0lEVEgsXG4gICAgSU1BR0VfSEVJR0hULFxuICAgIEFTUEVDVF9SQVRJTyxcbiAgICBJTUFHRV9TQ0FMSU5HX01BWCxcbiAgICBUQVJHRVRfUE9TSVRJT05fWCxcbiAgICBUQVJHRVRfUE9TSVRJT05fWSxcbiAgICBTSU5HTEVfTU9WRV9ESVNUQU5DRV9YLFxuICAgIEFMUEhBX0FOSU1BVElPTlMsXG4gICAgTEVGVF9BTFBIQV9MSU1JVCxcbiAgICBXSURUSCxcbiAgICBIRUlHSFQsXG4gICAgVVNFX1BPUlRBTF9TQ0FMSU5HLFxufSBmcm9tICcuL2NvbnN0YW50cydcbmltcG9ydCB7IFJvd09iamVjdFR5cGUgfSBmcm9tICcuL3R5cGVzJztcblxubGV0IHBvcnRhbFdpZHRoID0gV0lEVEg7XG5sZXQgcG9ydGFsSGVpZ2h0ID0gSEVJR0hUO1xuXG5cbi8vIFRPRE8gbW92ZSB0aGVzZSB0byBoZWxwZXIgZnVuY3Rpb25zIGNsYXNzXG5leHBvcnQgY29uc3QgYXBwbHlUcmFuc2xhdGUgPSAocG9zaXRpb25JbjogbnVtYmVyLCB0cmFuc2xhdGVJbjogbnVtYmVyKSA9PiB7XG4gICAgcmV0dXJuIHBvc2l0aW9uSW4gLSB0cmFuc2xhdGVJbjtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXREZWZhdWx0SW1hZ2UgPSAoKSA9PiB7XG4gICAgY29uc3QgZGVmYXVsdEltYWdlID0gbmV3IEltYWdlKElNQUdFX1dJRFRILCBJTUFHRV9IRUlHSFQpOyBcbiAgICBkZWZhdWx0SW1hZ2Uuc3JjID0gYC4vZGVmYXVsdEltYWdlLmpwZ2A7XG4gICAgcmV0dXJuIGRlZmF1bHRJbWFnZTtcbn1cblxuY29uc3QgZWFzZU91dFF1aW50ID0gKGRlbHRhOiBudW1iZXIpID0+IHtcbiAgICByZXR1cm4gMSAtIE1hdGgucG93KDEgLSBkZWx0YSwgNSk7XG59XG5cbmNvbnN0IGRyYXdTY2FsZWRGb2N1c0hpZ2hsaWdodCA9IChjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgaGlnaGxpZ2h0ZWRYSW46IG51bWJlciwgaGlnaGxpZ2h0ZWRZSW46IG51bWJlciwgaW1hZ2VTY2FsaW5nOiBudW1iZXIpID0+IHtcbiAgICBjb25zdCB4T2Zmc2V0ID0gKChJTUFHRV9XSURUSCAqIGltYWdlU2NhbGluZykgLSBJTUFHRV9XSURUSCkgLyAyO1xuICAgIGNvbnN0IHlPZmZzZXQgPSAoKElNQUdFX0hFSUdIVCAqIGltYWdlU2NhbGluZykgLSBJTUFHRV9IRUlHSFQpIC8gMjtcbiAgICBjdHgubGluZVdpZHRoID0gNTtcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBcIiNjY2NcIjtcbiAgICBjdHguYmVnaW5QYXRoKCk7XG4gICAgY3R4LnJlY3QoXG4gICAgICAgIGFwcGx5UG9ydGFsU2NhbGluZyhoaWdobGlnaHRlZFhJbiAtIHhPZmZzZXQpLCBcbiAgICAgICAgYXBwbHlQb3J0YWxTY2FsaW5nKGhpZ2hsaWdodGVkWUluIC0geU9mZnNldCksIFxuICAgICAgICBhcHBseVBvcnRhbFNjYWxpbmcoSU1BR0VfV0lEVEggKiBpbWFnZVNjYWxpbmcpLCBcbiAgICAgICAgYXBwbHlQb3J0YWxTY2FsaW5nKElNQUdFX0hFSUdIVCAqIGltYWdlU2NhbGluZylcbiAgICApO1xuICAgIGN0eC5zdHJva2UoKTtcbn07XG5cblxuZXhwb3J0IGNvbnN0IGRyYXdDYW52YXNCb3JkZXIgPSAoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpID0+IHtcbiAgICBjdHgubGluZVdpZHRoID0gMztcbiAgICBjdHguc3Ryb2tlU3R5bGUgPSBcImRhcmtncmVlblwiO1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHgucmVjdCgwLCAwLCBwb3J0YWxXaWR0aCwgcG9ydGFsV2lkdGggLyBBU1BFQ1RfUkFUSU8pO1xuICAgIGN0eC5zdHJva2UoKTtcbn1cblxuZXhwb3J0IGNvbnN0IGNsZWFyUG9ydGFsID0gKGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJEKSA9PiB7XG4gICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBwb3J0YWxXaWR0aCwgcG9ydGFsSGVpZ2h0KTtcbn1cblxuY29uc3Qgc2hvdWxkUmVuZGVyID0gKHhMZWZ0OiBudW1iZXIsIHhSaWdodDogbnVtYmVyLCB5VG9wOiBudW1iZXIsIHlCb3R0b206IG51bWJlcikgPT4ge1xuICAgIHJldHVybiAoeExlZnQgPCBXSURUSCAmJiB4UmlnaHQgPiAwICYmIHlUb3AgPCBIRUlHSFQgJiYgeUJvdHRvbSA+IDApO1xufTtcblxuY29uc3QgZ2V0QWxwaGEgPSAoeFBvczogbnVtYmVyKSA9PiB7XG4gICAgaWYgKCFBTFBIQV9BTklNQVRJT05TKSB7XG4gICAgICAgIHJldHVybiAxO1xuICAgIH1cbiAgICBpZiAoeFBvcyA8IFRBUkdFVF9QT1NJVElPTl9YKSB7XG4gICAgICAgIHJldHVybiBnZXRMZWZ0QWxwaGEoeFBvcyk7XG4gICAgfSBlbHNlIGlmICh4UG9zID4gV0lEVEggLSBJTUFHRV9XSURUSCkge1xuICAgICAgICByZXR1cm4gZ2V0UmlnaHRBbHBoYSh4UG9zKTtcbiAgICB9XG4gICAgcmV0dXJuIDE7XG59O1xuXG4vLyBmYWRlIGltYWdlcyBhcyB0aGV5IG1vdmUgb2ZmIHRvIHRoZSBsZWZ0XG5jb25zdCBnZXRMZWZ0QWxwaGEgPSAoeFBvczogbnVtYmVyKSA9PiB7XG4gICAgcmV0dXJuIE1hdGgubWF4KCh4UG9zK0lNQUdFX1dJRFRIKSAvIExFRlRfQUxQSEFfTElNSVQsIDAuMik7XG59O1xuXG4vLyBmYWRlIGltYWdlcyBvdXQgYXMgdGhleSBtb3ZlIG9mZiB0byB0aGUgcmlnaHRcbmNvbnN0IGdldFJpZ2h0QWxwaGEgPSAoeFBvczogbnVtYmVyKSA9PiB7XG4gICAgcmV0dXJuIE1hdGgubWF4KCgoV0lEVEggLSB4UG9zKSAvIElNQUdFX1dJRFRIKSwgMC4yKTtcbn07XG5cbmV4cG9ydCBjb25zdCBkcmF3U2NhbGVkQ2FyZCA9IChjdHg6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCwgaW1hZ2U6IENhbnZhc0ltYWdlU291cmNlLCB4UG9zOiBudW1iZXIsIHlQb3M6IG51bWJlcikgPT4ge1xuICAgIGlmIChzaG91bGRSZW5kZXIoeFBvcywgeFBvcyArIElNQUdFX1dJRFRILCB5UG9zLCB5UG9zICsgSU1BR0VfSEVJR0hUKSkge1xuICAgICAgICBjb25zdCBpc0hpZ2hsaWdodGVkSW1hZ2UgPSAoKHhQb3MgPT09IFRBUkdFVF9QT1NJVElPTl9YKSAmJiB5UG9zID09PSBUQVJHRVRfUE9TSVRJT05fWSk7XG4gICAgICAgIGNvbnN0IGltYWdlU2NhbGluZyA9IGlzSGlnaGxpZ2h0ZWRJbWFnZSA/IDEgKyBJTUFHRV9TQ0FMSU5HX01BWCA6IDFcbiAgICAgICAgY29uc3QgeE9mZnNldCA9ICgoSU1BR0VfV0lEVEggKiBpbWFnZVNjYWxpbmcpIC0gSU1BR0VfV0lEVEgpIC8gMjsgLy8gb2Zmc2V0IGJ5IHNjYWxlZCBhbW91bnQgc28gaXQgc2NhbGVzIGZyb20gY2VudHJlIHJhdGhlciB0aGFuIHRvcCBsZWZ0IGNvcm5lclxuICAgICAgICBjb25zdCB5T2Zmc2V0ID0gKChJTUFHRV9IRUlHSFQgKiBpbWFnZVNjYWxpbmcpIC0gSU1BR0VfSEVJR0hUKSAvIDI7XG4gICAgICAgIGNvbnN0IGFscGhhID0gZ2V0QWxwaGEoeFBvcyk7XG4gICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhO1xuICAgICAgICBjdHguZHJhd0ltYWdlKFxuICAgICAgICAgICAgaW1hZ2UsXG4gICAgICAgICAgICBhcHBseVBvcnRhbFNjYWxpbmcoeFBvcyAtIHhPZmZzZXQpLFxuICAgICAgICAgICAgYXBwbHlQb3J0YWxTY2FsaW5nKHlQb3MgLSB5T2Zmc2V0KSxcbiAgICAgICAgICAgIGFwcGx5UG9ydGFsU2NhbGluZyhJTUFHRV9XSURUSCAqIGltYWdlU2NhbGluZyksXG4gICAgICAgICAgICBhcHBseVBvcnRhbFNjYWxpbmcoSU1BR0VfSEVJR0hUICogaW1hZ2VTY2FsaW5nKSxcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGlzSGlnaGxpZ2h0ZWRJbWFnZSkge1xuICAgICAgICAgICAgLy8gZm9jdXMgaGlnaGxpZ2h0IHdpbGwgYmUgcGFydGlhbGx5IGNvbmNlYWxlZCBieSBjYXJkXG4gICAgICAgICAgICAvLyBUT0RPIGZvY3VzIGhpZ2hsaWdodCBzaG91bGQgbm90IGJlIGRyYXduIG92ZXIgdGhlIGNhcmQgaW1hZ2VzIC0gcmVtb3ZlIHRoaXMgd2hlbiBmaXhlZFxuICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxO1xuICAgICAgICBkcmF3U2NhbGVkRm9jdXNIaWdobGlnaHQoY3R4LCB4UG9zLCB5UG9zLCBpbWFnZVNjYWxpbmcpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG5leHBvcnQgY29uc3QgZHJhd1NjYWxlZEltYWdlID0gKGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCBpbWFnZTogQ2FudmFzSW1hZ2VTb3VyY2UsIHhQb3M6IG51bWJlciwgeVBvczogbnVtYmVyLCB3aWR0aD1JTUFHRV9XSURUSCwgaGVpZ2h0PUlNQUdFX0hFSUdIVCkgPT4ge1xuICAgIGN0eC5kcmF3SW1hZ2UoXG4gICAgICAgIGltYWdlLFxuICAgICAgICBhcHBseVBvcnRhbFNjYWxpbmcoeFBvcyksXG4gICAgICAgIGFwcGx5UG9ydGFsU2NhbGluZyh5UG9zKSxcbiAgICAgICAgYXBwbHlQb3J0YWxTY2FsaW5nKHdpZHRoKSxcbiAgICAgICAgYXBwbHlQb3J0YWxTY2FsaW5nKGhlaWdodCksXG4gICAgKVxufVxuXG4vLyBzY2FsZXMgYSB2YWx1ZSBiYXNlZCB1cG9uIHRoZSBkaWZmZXJlbmVzIGluIHRoZSBkZWZhdWx0IHZzIGN1cnJlbnQgd2lkdGggKGFzc3VtZXMgY29uc2lzdGVudCBhc3BlY3QgcmF0aW8pXG5leHBvcnQgY29uc3QgYXBwbHlQb3J0YWxTY2FsaW5nID0gKHZhbHVlOiBudW1iZXIpID0+IHtcbiAgICBpZiAoVVNFX1BPUlRBTF9TQ0FMSU5HKSB7IFxuICAgICAgICByZXR1cm4gKHBvcnRhbFdpZHRoIC8gV0lEVEgpICogdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiB2YWx1ZTtcbiAgXG59XG5cbmV4cG9ydCBjb25zdCByZXNpemVkV2luZG93ID0gKHdpZHRoSW46IG51bWJlciwgaGVpZ2h0SW46IG51bWJlcikgPT4ge1xuICAgIHBvcnRhbEhlaWdodCA9IGhlaWdodEluO1xuICAgIHBvcnRhbFdpZHRoID0gd2lkdGhJbjtcbn07XG5cbi8vIGFsbCBhbGwgdGhlIGNhcmRzIGFuZCBoaWdobGlnaHRlZCBjYXJkcyBvdXRsaW5lXG5leHBvcnQgY29uc3QgcmVuZGVyQ2FyZHMgPSAoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQsIHJvd3NEYXRhOiBBcnJheTxSb3dPYmplY3RUeXBlPiwgc2VsZWN0ZWRSb3c6IG51bWJlciwgdW5maW5pc2hlZE1vdmVtZW50WTogbnVtYmVyLCB0cmFuc2xhdGVZOiBudW1iZXIsIGFuaW1hdGlvblN0YXJ0VGltZVk6IG51bWJlciwgc2NhbGluZ0FuaW1hdGlvblByb2dyZXNzaW9uOiBudW1iZXIpID0+IHtcbiAgICBsZXQgZHJhd1NlbGVjdGVkQ2FyZExhc3QgPSAoKSA9PiB7fTtcblxuICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IHJvd3NEYXRhLmxlbmd0aDsgcm93KyspIHtcbiAgICAgICAgY29uc3Qgcm93T2JqZWN0ID0gcm93c0RhdGFbcm93XTtcbiAgICAgICAgbGV0IHsgdW5maW5pc2hlZE1vdmVtZW50WCwgYW5pbWF0aW9uU3RhcnRUaW1lIH0gPSByb3dPYmplY3Q7XG4gICAgICAgIGlmIChhbmltYXRpb25TdGFydFRpbWUpIHtcbiAgICAgICAgICAgIGNvbnN0IHRpbWVOb3cgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgY29uc3QgdGltZUVsYXBzZWRYID0gdGltZU5vdyAtIGFuaW1hdGlvblN0YXJ0VGltZTtcbiAgICAgICAgICAgIGNvbnN0IGFuaW1hdGlvblBvc2l0aW9uID0gTWF0aC5taW4odGltZUVsYXBzZWRYIC8gQU5JTUFUSU9OX0RVUkFUSU9OLCAxKTsgLy8gaG93IGZhciB0aHJvdWdoIHRoZSBhbmltYXRpb24gd2UgYXJlIGZyb20gMCAoc3RhcnQpIHRvIDEgKGVuZClcbiAgICAgICAgICAgIGNvbnN0IGVhc2luZ1Bvc2l0aW9uID0gZWFzZU91dFF1aW50KGFuaW1hdGlvblBvc2l0aW9uKTsgLy8gYXBwbHkgZWFzaW5nIHdoaWNoIG1vZGlmaWVzIHRoZSBhbmltYXRpb24gcG9zaXRpb24gYmFzZWQgdXBvbiBlYXNpbmcgZXF1YXNpb25cbiAgICAgICAgICAgIHJvd09iamVjdC5lYXNpbmdQb3NpdGlvbiA9IGVhc2luZ1Bvc2l0aW9uOyAvLyB1c2VkIGZvciBzY2FsaW5nIGhpZ2hsaWdodGVkIGltYWdlXG4gICAgICAgICAgICBpZiAocm93T2JqZWN0LmFuaW1hdGlvbkRpcmVjdGlvbiA9PT0gJ3JpZ2h0JykgeyAvLyBpZiByaWdodFxuICAgICAgICAgICAgICAgIHJvd09iamVjdC50cmFuc2xhdGVYID0gKHJvd09iamVjdC50YXJnZXRUcmFuc2xhdGVYIC0gU0lOR0xFX01PVkVfRElTVEFOQ0VfWCkgKyAoKFNJTkdMRV9NT1ZFX0RJU1RBTkNFX1ggKyB1bmZpbmlzaGVkTW92ZW1lbnRYKSAqIGVhc2luZ1Bvc2l0aW9uKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAocm93T2JqZWN0LmFuaW1hdGlvbkRpcmVjdGlvbiA9PT0gJ2xlZnQnKSB7IC8vIGlmIGdvaW5nIGxlZnRcbiAgICAgICAgICAgICAgICByb3dPYmplY3QudHJhbnNsYXRlWCA9ICgocm93T2JqZWN0LnRhcmdldFRyYW5zbGF0ZVggKyBTSU5HTEVfTU9WRV9ESVNUQU5DRV9YKSkgLSAoKFNJTkdMRV9NT1ZFX0RJU1RBTkNFX1ggLSB1bmZpbmlzaGVkTW92ZW1lbnRYKSAqIGVhc2luZ1Bvc2l0aW9uKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhbmltYXRpb25Qb3NpdGlvbiA+PSAxKSB7IC8vIGFuaW1hdGlvbiBlbmRpbmdcbiAgICAgICAgICAgICAgICByb3dPYmplY3QuYW5pbWF0aW9uU3RhcnRUaW1lID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBjYXJkID0gMDsgY2FyZCA8IHJvd3NEYXRhW3Jvd10uY2FyZHMubGVuZ3RoOyBjYXJkKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGNhcmRPYmplY3QgPSByb3dPYmplY3QuY2FyZHNbY2FyZF07IC8vIFRPRE8gcmVuYW1lIHRoaXMgdG8gY2FyZCBhbmQgaW50ZWdlciB0byBjYXJkTnVtYmVyXG4gICAgICAgICAgICBjb25zdCB7IGltYWdlLCBjYXJkT3JpZ2luYWxQb3NpdGlvblgsIGNhcmRPcmlnaW5hbFBvc2l0aW9uWSB9ID0gY2FyZE9iamVjdDtcbiAgICAgICAgICAgIGNvbnN0IHhQb3MgPSBhcHBseVRyYW5zbGF0ZShjYXJkT3JpZ2luYWxQb3NpdGlvblggKyB1bmZpbmlzaGVkTW92ZW1lbnRYICsgVEFSR0VUX1BPU0lUSU9OX1gsIHJvd09iamVjdC50cmFuc2xhdGVYKTsgLy8gdHJhbnNsYXRlWCBhZmZlY3RzIG9ubHkgY3VycmVudCByb3dcbiAgICAgICAgICAgIGNvbnN0IHlQb3MgPSBhcHBseVRyYW5zbGF0ZShjYXJkT3JpZ2luYWxQb3NpdGlvblkgKyBUQVJHRVRfUE9TSVRJT05fWSArIHVuZmluaXNoZWRNb3ZlbWVudFksIHRyYW5zbGF0ZVkpOyAvLyB0cmFuc2xhdGVZIGFmZmVjdHMgYWxsIHJvd3NcblxuICAgICAgICAgICAgY29uc3QgeyBoaWdobGlnaHRlZENhcmQgfSA9IHJvd09iamVjdDtcbiAgICAgICAgICAgIC8vIGRvIHNvbWV0aGluZyBkaWZmZXJlbnQgaWYgd2UgYXJlIGFib3V0IHRvIGRyYXcgdGhlIGhpZ2hsaWdodGVkIGNhcmRcbiAgICAgICAgICAgIGlmIChyb3cgPT09IHNlbGVjdGVkUm93ICYmIGNhcmQgPT0gaGlnaGxpZ2h0ZWRDYXJkKSB7XG4gICAgICAgICAgICAgICAgbGV0IHNjYWxpbmdQcm9ncmVzc2lvbiA9IDA7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBlYXNpbmdQb3NpdGlvbiB9ID0gcm93c0RhdGFbcm93XTtcbiAgICAgICAgICAgICAgICBpZiAoZWFzaW5nUG9zaXRpb24pIHsgLy8gaWYgd2UgYXJlIGFuaW1hdGluZyBvbiB4IGF4aXMgdGhlbiB1c2UgbG9jYWwgZWFzaW5nIHBvc2l0aW9uIGZvciBzY2FsaW5nIGFuaW1hdGlvbiBwcm9ncmVzc2lvblxuICAgICAgICAgICAgICAgICAgICBzY2FsaW5nUHJvZ3Jlc3Npb24gPSBlYXNpbmdQb3NpdGlvbjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGFuaW1hdGlvblN0YXJ0VGltZVkpIHsgLy8gaWYgd2UgYXJlIGFuaW1hdGluZyBvbiB5IGF4aXMgdGhlbiB1c2UgeSBhbmltYXRpb24gZWFzaW5nIHBvc2l0aW9uIGluc3RlYWRcbiAgICAgICAgICAgICAgICAgICAgc2NhbGluZ1Byb2dyZXNzaW9uID0gc2NhbGluZ0FuaW1hdGlvblByb2dyZXNzaW9uO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNjYWxpbmdQcm9ncmVzc2lvbiA9IDE7IC8vIG90aGVyd2lzZSB3ZSBhcmUgYXQgcmVzdCwgc28gZW5zdXJlIGZvY3VzZWQgaXRlbSBlbmQgb2YgYW5pbWF0aW9uIHNpemVkIGllIDFcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgaW1hZ2VTY2FsaW5nID0gKHNjYWxpbmdQcm9ncmVzc2lvbiAqIElNQUdFX1NDQUxJTkdfTUFYKSArMTtcbiAgICAgICAgICAgICAgICBjb25zdCB4T2Zmc2V0ID0gKChJTUFHRV9XSURUSCAqIGltYWdlU2NhbGluZykgLSBJTUFHRV9XSURUSCkgLyAyOyAvLyBvZmZzZXQgYnkgc2NhbGVkIGFtb3VudCBzbyBpdCBzY2FsZXMgZnJvbSBjZW50cmUgcmF0aGVyIHRoYW4gdG9wIGxlZnQgY29ybmVyXG4gICAgICAgICAgICAgICAgY29uc3QgeU9mZnNldCA9ICgoSU1BR0VfSEVJR0hUICogaW1hZ2VTY2FsaW5nKSAtIElNQUdFX0hFSUdIVCkgLyAyO1xuICAgICAgICAgICAgICAgIGRyYXdTZWxlY3RlZENhcmRMYXN0ID0gKCkgPT4geyAvLyBzZXQgdGhpcyBhcyBhIGNhbGxiYWNrIHNvIHRoZSBoaWdobGlnaHRlZCBjYXJkIGlzIGRyYXduIGxhc3QgdG8gcHJldmVudCBpdCBjbGlwcGluZyBiZWhpbmQgb3RoZXIgY2FyZHNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgYWxwaGEgPSBnZXRBbHBoYSh4UG9zKTtcbiAgICAgICAgICAgICAgICAgICAgY3R4Lmdsb2JhbEFscGhhID0gYWxwaGE7XG4gICAgICAgICAgICAgICAgICAgIGRyYXdTY2FsZWRJbWFnZShjdHgsIGltYWdlLCB4UG9zIC0geE9mZnNldCwgeVBvcyAtIHlPZmZzZXQsIElNQUdFX1dJRFRIICogaW1hZ2VTY2FsaW5nLCBJTUFHRV9IRUlHSFQgKiBpbWFnZVNjYWxpbmcpO1xuICAgICAgICAgICAgICAgICAgICAvLyBjdHguZHJhd0ltYWdlKGltYWdlLCB4UG9zIC0geE9mZnNldCwgeVBvcyAtIHlPZmZzZXQsIElNQUdFX1dJRFRIICogaW1hZ2VTY2FsaW5nLCBJTUFHRV9IRUlHSFQgKiBpbWFnZVNjYWxpbmcpO1xuICAgICAgICAgICAgICAgICAgICBjdHguZ2xvYmFsQWxwaGEgPSAxO1xuICAgICAgICAgICAgICAgICAgICBkcmF3U2NhbGVkRm9jdXNIaWdobGlnaHQoY3R4LCB4UG9zLCB5UG9zLCBpbWFnZVNjYWxpbmcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHNob3VsZFJlbmRlcih4UG9zLCB4UG9zICsgSU1BR0VfV0lEVEgsIHlQb3MsIHlQb3MgKyBJTUFHRV9IRUlHSFQpKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGFscGhhID0gZ2V0QWxwaGEoeFBvcyk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IGFscGhhO1xuICAgICAgICAgICAgICAgICAgICBkcmF3U2NhbGVkSW1hZ2UoY3R4LCBpbWFnZSwgeFBvcywgeVBvcyk7XG4gICAgICAgICAgICAgICAgICAgIGN0eC5nbG9iYWxBbHBoYSA9IDE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGRyYXdTZWxlY3RlZENhcmRMYXN0KCk7XG59OyIsImltcG9ydCB7IFRBUkdFVF9QT1NJVElPTl9YLCBUQVJHRVRfUE9TSVRJT05fWSwgSU1BR0VfV0lEVEggfSBmcm9tIFwiLi9jb25zdGFudHNcIjtcbmltcG9ydCB7IFBvcHVsYXJSZXNwb25zZVR5cGUsIFJvd0ltYWdlVHlwZSwgUm93T2JqZWN0VHlwZSB9IGZyb20gJy4vdHlwZXMnO1xuXG5jb25zdCBhdXRoS2V5ID0gJ2MwMTQwMDMxNjExZjM2ZGE3OWE0MDAxYWZmYWFkODk2JztcbmxldCBnZW5yZXM6IEFycmF5PFJvd09iamVjdFR5cGU+ID0gW107XG4vLyBUT0RPIHRoZXNlIHR3byBmdW50aW9ucyBzaG91bGQgYmUga2VwdCBpbiBhIGhlbHBlcnMgY2xhc3NcbmltcG9ydCB7IGRyYXdTY2FsZWRDYXJkLCBhcHBseVRyYW5zbGF0ZSB9IGZyb20gXCIuL3JlbmRlckNhcmRzXCI7XG5cbi8vIGdyYWJzIHRoZSBsaXN0IG9mIGF2YWlsYWJsZSBnZW5yZXMgZnJvbSB0aGUgbW92aWUgZGJcbmNvbnN0IGZldGNoR2VucmVzID0gKCkgPT4ge1xuICBjb25zdCB1cmwgPSBgaHR0cHM6Ly9hcGkudGhlbW92aWVkYi5vcmcvMy9nZW5yZS9tb3ZpZS9saXN0P2FwaV9rZXk9JHthdXRoS2V5fSZsYW5ndWFnZT1lbi1VS2A7XG4gIHJldHVybiBmZXRjaCh1cmwsIHtcbiAgICBtZXRob2Q6ICdHRVQnXG4gIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgaWYgKHJlc3BvbnNlLm9rKSB7XG4gICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpXG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChyZXNwb25zZSk7XG4gICAgfVxuICB9KVxufTtcblxuLy8gR3JhYnMgYSBnZW5yZSBmcm9tIHRoZSBtb3ZpZSBkYiB1c2luZyBhIGdlbnJlSUQuIFRoaXMgY29udGFpbnMgdGhlIHRvcCAyMCBtb3ZpZXMgaW4gdGhhdCBnZW5yZS5cbmNvbnN0IGZldGNoR2VucmVSb3cgPSBhc3luYyAoZ2VucmVJZDpudW1iZXIpOiBQcm9taXNlPFBvcHVsYXJSZXNwb25zZVR5cGU+ID0+IHtcbiAgY29uc3QgdXJsID0gYGh0dHBzOi8vYXBpLnRoZW1vdmllZGIub3JnLzMvZGlzY292ZXIvbW92aWU/d2l0aF9nZW5yZXM9JHtnZW5yZUlkfSZzb3J0X2J5PXBvcHVsYXJpdHkuZGVzYyZ2b3RlX2NvdW50Lmd0ZT0xMCZhcGlfa2V5PSR7YXV0aEtleX1gO1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCwge1xuICAgIG1ldGhvZDogJ0dFVCdcbiAgfSk7XG4gIGlmIChyZXNwb25zZS5vaykge1xuICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHJlc3BvbnNlKTtcbiAgfVxufVxuXG4vLyByYW5kb21seSBzcGxpY2VzIGEgZ2VucmUgb3V0IG9mIHRoZSBsaXN0IG9mIGdlbnJlc1xuY29uc3QgZ2V0UmFuZG9tR2VucmUgPSAoKSA9PiB7XG4gIHJldHVybiBnZW5yZXMuc3BsaWNlKE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSpnZW5yZXMubGVuZ3RoKSwgMSlbMF07XG59O1xuXG4vLyBjcmVhdGVzIGFuIGltYWdlIGVsZW1lbnQgZnJvbSBhIHN1cHBsaWVkIHVybFxuY29uc3QgbG9hZEltYWdlID0gKGltYWdlVXJsOiBzdHJpbmcpOiBQcm9taXNlPEhUTUxJbWFnZUVsZW1lbnQ+ID0+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgICBpbWcub25sb2FkID0gKCkgPT4gcmVzb2x2ZShpbWcpO1xuICAgIGltZy5vbmVycm9yID0gKCkgPT4gcmVqZWN0KG5ldyBFcnJvcihgbG9hZCAke2ltYWdlVXJsfSBmYWlsYCkpO1xuICAgIGltZy5zcmMgPSBpbWFnZVVybDtcbiAgfSk7XG59O1xuXG4vLyBnZW5lcmF0ZXMgdGhlIHJvd3MgZGF0YSBieSByYW5kb20gZ3JhYmJpbmcgbGlzdHMgb2YgcG9wdWxhciB0aXRsZXMgZnJvbSB0aGUgbGlzdCBvZiBnZW5yZXMgc3VwcGxpZWQgYnkgdGhlIG1vdmllIGRiXG5leHBvcnQgY29uc3QgZ2V0Um93c0RhdGEgPSAoZGVmYXVsdEltYWdlOiBIVE1MSW1hZ2VFbGVtZW50LCBJTUFHRV9XSURUSDogbnVtYmVyLCBJTUFHRV9IRUlHSFQ6IG51bWJlciwgUEFERElORzogbnVtYmVyKTogUHJvbWlzZTxBcnJheTxSb3dPYmplY3RUeXBlPj4gPT4ge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGZldGNoR2VucmVzKCkudGhlbigocmVzKSA9PiB7XG4gICAgICBnZW5yZXMgPSByZXMuZ2VucmVzO1xuICAgICAgY29uc3QgaW50aWFsUm93cyA9IFtdO1xuICAgICAgY29uc3QgdGhlUm93c0RhdGE6IEFycmF5PFJvd09iamVjdFR5cGU+ID0gW107XG4gICAgICBpbnRpYWxSb3dzLnB1c2goZ2V0UmFuZG9tR2VucmUoKSk7XG4gICAgICBpbnRpYWxSb3dzLnB1c2goZ2V0UmFuZG9tR2VucmUoKSk7XG4gICAgICBpbnRpYWxSb3dzLnB1c2goZ2V0UmFuZG9tR2VucmUoKSk7XG4gICAgICBpbnRpYWxSb3dzLnB1c2goZ2V0UmFuZG9tR2VucmUoKSk7XG4gICAgICBsZXQgcm93Q291bnRlciA9IDA7XG4gICAgICBpbnRpYWxSb3dzLmZvckVhY2goKHJvd0luKSA9PiB7XG4gICAgICAgIGZldGNoR2VucmVSb3cocm93SW4uaWQpLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgIGNvbnN0IHsgcmVzdWx0cyB9ID0gcmVzO1xuICAgICAgICAgIHJlc3VsdHMubGVuZ3RoID0gMTA7IC8vIFRPRE8gb25seSBsb2FkIGFzc2V0cyB0aGF0IGFyZSBnb2luZyB0byBiZSBzZWVuLiBUZW1wb3JhcmlseSBjaG9wcGluZyB0aGUgYXJyYXkgaW4gaGFsZiB1bnRpbCB0aGlzIGlzIGFkZGVkXG4gICAgICAgICAgY29uc3QgY2FyZHMgPSByZXMucmVzdWx0cy5tYXAoKGNhcmQsIGNhcmRJbmRleCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgeyBvcmlnaW5hbF90aXRsZSwgb3ZlcnZpZXcsIGJhY2tkcm9wX3BhdGgsIHBvc3Rlcl9wYXRoLCByZWxlYXNlX2RhdGUgfSA9IGNhcmQ7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBpbWFnZTogZGVmYXVsdEltYWdlLFxuICAgICAgICAgICAgICBjYXJkT3JpZ2luYWxQb3NpdGlvblg6IGNhcmRJbmRleCAqIChJTUFHRV9XSURUSCArIFBBRERJTkcpLFxuICAgICAgICAgICAgICBjYXJkT3JpZ2luYWxQb3NpdGlvblk6IHJvd0NvdW50ZXIgKiAoSU1BR0VfSEVJR0hUICsgUEFERElORyksXG4gICAgICAgICAgICAgIG9yaWdpbmFsX3RpdGxlLFxuICAgICAgICAgICAgICBvdmVydmlldyxcbiAgICAgICAgICAgICAgYmFja2Ryb3BfcGF0aCxcbiAgICAgICAgICAgICAgcG9zdGVyX3BhdGgsXG4gICAgICAgICAgICAgIHJlbGVhc2VfZGF0ZSxcbiAgICAgICAgICAgIH0gYXMgUm93SW1hZ2VUeXBlO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgY29uc3Qgcm93OiBSb3dPYmplY3RUeXBlID0ge1xuICAgICAgICAgICAgaWQ6IHJvd0luLmlkLFxuICAgICAgICAgICAgY2FyZHMsXG4gICAgICAgICAgICByb3dOdW1iZXI6IHJvd0NvdW50ZXIsXG4gICAgICAgICAgICBoaWdobGlnaHRlZENhcmQ6IDAsXG4gICAgICAgICAgICB0cmFuc2xhdGVYOiAwLCAvLyBwb3NpdGlvbiBvZmZzZXQgZnJvbSBzdGFydGluZyBwb2ludFxuICAgICAgICAgICAgYW5pbWF0aW9uU3RhcnRUaW1lOiBudWxsLFxuICAgICAgICAgICAgYW5pbWF0aW9uRGlyZWN0aW9uOiBudWxsLFxuICAgICAgICAgICAgdGFyZ2V0VHJhbnNsYXRlWDogMCwgLy8gdGhlIGVuZCB0cmFuc2xhdGVYIHBvc2l0aW9uIG9mIHRoZSBhbmltYXRpb24gdXBvbiBjb21wbGV0aW9uIG9mIGFuaW1hdGlvblxuICAgICAgICAgICAgZWFzaW5nUG9zaXRpb246IDAsIC8vIGhvdyBmYXIgdGhyb3VnaCB4IGFuaW1hdGlvbiByb3cgaXMuIFVzZWQgZm9yIGNhbGN1bGF0aW5nIHNjYWxpbmcgb2YgaGlnaGxpZ2h0ZWQgaW1hZ2VcbiAgICAgICAgICAgIHVuZmluaXNoZWRNb3ZlbWVudFg6IDAsIC8vIGlmIHdlIGludGVycnVwdCBhbiBYIG1vdmVtZW50IHdlIG5lZWQgdG8gaW5jbHVkZSB0aGlzIGluIHRoZSBuZXcgYW5pbWF0aW9uIHN0YXJ0IHBvc2l0aW9uXG4gICAgICAgICAgfVxuICAgICAgICAgIHJvd0NvdW50ZXIgKz0xIDtcbiAgICAgICAgICB0aGVSb3dzRGF0YS5wdXNoKHJvdylcbiAgICAgICAgICBpZiAodGhlUm93c0RhdGEubGVuZ3RoID09PSBpbnRpYWxSb3dzLmxlbmd0aCkge1xuICAgICAgICAgICAgcmVzb2x2ZSh0aGVSb3dzRGF0YSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgfSlcbiAgICB9KTtcbiAgfSlcbn07XG5cblxuLy8gbG9hZHMgYW5kIHJlLXJlbmRlcnMgaW1hZ2VzXG5leHBvcnQgY29uc3QgbG9hZEFuZFJlbmRlckltYWdlcyA9IChyb3dzRGF0YTogQXJyYXk8Um93T2JqZWN0VHlwZT4sIGN0eDogQ2FudmFzUmVuZGVyaW5nQ29udGV4dDJELCB0cmFuc2xhdGVZOiBudW1iZXIgKSA9PiB7XG4gIHJvd3NEYXRhLmZvckVhY2goKHJvdywgcm93TnVtKSA9PiB7XG4gICAgcm93LmNhcmRzLmZvckVhY2goKGltYWdlLCBpbWFnZU51bSkgPT4ge1xuICAgICAgY29uc3QgZnVsbEltYWdlVXJsID0gYGh0dHBzOi8vaW1hZ2UudG1kYi5vcmcvdC9wL3cke0lNQUdFX1dJRFRIfSR7aW1hZ2UucG9zdGVyX3BhdGh9YDtcbiAgICAgIC8vIGJhY2tkcm9wX3BhdGggY2FuIGJlIHVzZWQgZm9yIHRoZSBiYWNrZ3JvdW5kIGltYWdlcyBvbiBmb2N1c1xuICAgICAgbG9hZEltYWdlKGZ1bGxJbWFnZVVybCkudGhlbihpbWFnZSA9PiB7IC8vIFRPRE8gY2FsbGJhY2sgdG8gcmVuZGVyIGltYWdlIGFmdGVyIGxvYWRpbmcgaXMgdmVyeSBiYXNpYyBhbmQgc2hvdWxkIGluc3RlYWQgZHJhdyB0aGUgaW1hZ2UgYmFzZWQgb24gaXQncyByZWFsIGxvY2F0aW9uIGluIGNhc2UgdGhpbmdzIGxvYWQgaW4gbGF0ZVxuICAgICAgICAvLyB1cGRhdGUgdGhlIGRhdGFcbiAgICAgICAgcm93c0RhdGFbcm93TnVtXS5jYXJkc1tpbWFnZU51bV0uaW1hZ2UgPSBpbWFnZTtcbiAgICAgICAgY29uc3QgeyB0cmFuc2xhdGVYIH0gPSByb3dzRGF0YVtyb3dOdW1dO1xuICAgICAgICBjb25zdCB7IGNhcmRPcmlnaW5hbFBvc2l0aW9uWCwgY2FyZE9yaWdpbmFsUG9zaXRpb25ZIH0gPSByb3dzRGF0YVtyb3dOdW1dLmNhcmRzW2ltYWdlTnVtXTtcbiAgICAgICAgLy8gYnV0IGFsc28gcmVkcmF3IHRoZSBpbWFnZSBqdXN0IG5vdyB3aXRoIGxvYWRlZCBpbWFnZVxuICAgICAgICBjb25zdCB4UG9zID0gYXBwbHlUcmFuc2xhdGUoY2FyZE9yaWdpbmFsUG9zaXRpb25YICsgVEFSR0VUX1BPU0lUSU9OX1gsIHRyYW5zbGF0ZVgpO1xuICAgICAgICBjb25zdCB5UG9zID0gYXBwbHlUcmFuc2xhdGUoY2FyZE9yaWdpbmFsUG9zaXRpb25ZICsgVEFSR0VUX1BPU0lUSU9OX1ksIHRyYW5zbGF0ZVkpO1xuICAgICAgICAvLyBUT0RPIHRoaXMgc2hvdWxkbid0IG5lZWQgdG8gYmUgZHJhd24gaGVyZS5cbiAgICAgICAgZHJhd1NjYWxlZENhcmQoY3R4LCBpbWFnZSwgeFBvcywgeVBvcyk7XG4gICAgICB9KTtcbiAgICB9KVxuICB9KVxuICByZXR1cm4gcm93c0RhdGE7XG59IiwiaW1wb3J0IHsgcmVuZGVyQ2FyZHMsIHJlc2l6ZWRXaW5kb3csIGNsZWFyUG9ydGFsLCBkcmF3Q2FudmFzQm9yZGVyLCBnZXREZWZhdWx0SW1hZ2UgfSBmcm9tICcuL3JlbmRlckNhcmRzJztcbmltcG9ydCB7ICAgICAgICAgICAgICAgICAgICAgXG4gICAgQU5JTUFUSU9OX0RVUkFUSU9OLFxuICAgIEhPVkVSX1RJTUVPVVQsXG4gICAgSU1BR0VfV0lEVEgsXG4gICAgSU1BR0VfSEVJR0hULFxuICAgIFBBRERJTkcsXG4gICAgTlVNQkVSX09GX1JPV1MsXG4gICAgVEFSR0VUX1BPU0lUSU9OX1ksXG4gICAgRlJBTUVfUkFURSxcbiAgICBTSU5HTEVfTU9WRV9ESVNUQU5DRV9YLFxuICAgIFNJTkdMRV9NT1ZFX0RJU1RBTkNFX1ksXG4gICAgV0lEVEgsXG4gICAgSEVJR0hULFxuICAgIFVTRV9SRVFVRVNUX0FOSU1BVElPTl9GUkFNRSxcbiAgICBERUJVRyxcbn0gZnJvbSAnLi9jb25zdGFudHMnO1xuaW1wb3J0IHtcbiAgICBnZXRSb3dzRGF0YSxcbiAgICBsb2FkQW5kUmVuZGVySW1hZ2VzLFxufSBmcm9tICcuL2FwaSc7XG5pbXBvcnQgeyBSb3dPYmplY3RUeXBlIH0gZnJvbSAnLi90eXBlcyc7XG5cbi8vIFRPRE8gbW92ZSB0byBoZWxwZXIgZnVuY3Rpb25zIG1vZHVsZVxuY29uc3QgZWFzZU91dFF1aW50ID0gKGRlbHRhOiBudW1iZXIpID0+IHtcbiAgICByZXR1cm4gMSAtIE1hdGgucG93KDEgLSBkZWx0YSwgNSk7XG59XG5cbi8vIEJVRyBmYXN0IHVwIGFuZCBkb3duIGNhdXNlcyBnbGl0Y2ggLSBwcmV2RGlyZWN0aW9uIGFuZCBhIHRpbWVyIGhhY2sgdXNlZCB1bnRpbCB0aGlzIGlzIGZpeGVkIHByb3Blcmx5XG4vLyBUT0RPIGFkZCBjYXJvdXNlbCByb3cgdGl0bGVzIC0gc2hvdyBoaWdobGlnaHRlZCBjYXJvdXNlbCByb3cgdGl0bGUgdG8gdGhlIHJpZ2h0IHRoYXQgZmFkZXMgb3V0IG92ZXIgdGltZVxuLy8gVE9ETyBtb3ZlIHJlc3Qgb2YgY2FyZHMgZHJhd2luZyBzdHVmZiBvdXQgb2YgbWFpbi5qc1xuLy8gVE9ETyBtb3ZlIFkgcmVuZGVyaW5nIGNhbGN1bGF0aW9ucyBmcm9tIGRyYXcgaW50byBzZXBhcmF0ZSBtb2R1bGVcbi8vIFRPRE8gbG9vayBhdCBvbmx5IGZldGNoaW5nIGltYWdlcyBmb3IgY2FyZHMgdGhhdCBhcmUgdmlzaWJsZSBvciBzb29uIHRvIGJlIHZpc2libGVcbi8vIFRPRE8gcmVuZGVyaW5nIG9mIGxvYWRlZCBpbWFnZXMgdXNpbmcgZHJhd1NjYWxlZENhcmQoKSBkb2VzIG5vdCBjb25zaWRlciBhbmltYXRpb24gcG9zaXRpb24uIFRoaXMgY291bGQgY2F1c2UgYSBidWcgd2hlcmUgYSBsYXRlIGxvYWRlZCBpbWFnZSBhcHBlYXJzIGluIHRoZSB3cm9uZyBwbGFjZSBkdXJpbmcgYSBzaW5nbGUgYW5pbWF0aW9uIGZyYW1lXG4vLyBUT0RPIHNob3cgcHJvZ3JhbW1lIGluZm9ybWF0aW9uIGFuZCBsYXJnZXIgcG9zdGVyIGltYWdlIHdoZW4gYW4gaXRlbSBpcyBzZWxlY3RlZCBmb3IgbG9uZ2VyIHRoYW4gSE9WRVJfVElNRU9VVFxuXG5jb25zdCBjYW52YXMgPSA8SFRNTENhbnZhc0VsZW1lbnQ+ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcycpO1xuY2FudmFzLndpZHRoID0gV0lEVEg7XG5jYW52YXMuaGVpZ2h0ID0gSEVJR0hUO1xuY29uc3QgY3R4ID0gPENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRD4gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5cbmxldCBoaWdobGlnaHRDdXJyZW50UG9zaXRpb25ZID0gVEFSR0VUX1BPU0lUSU9OX1k7XG5sZXQgaG92ZXJUaW1lcjogbnVtYmVyO1xubGV0IHNjYWxpbmdBbmltYXRpb25Qcm9ncmVzc2lvbiA9IDA7IC8vIGhvdyBmYXIgdGhyb3VnaCB0aGUgY3VycmVudCBhbmltYXRpb24gYXJlIHdlIC0gdXNlZCB0byBzY2FsZSBoaWdobGlnaHRnZWQgaW1hZ2VcbmxldCBhbmltYXRpb25TdGFydFRpbWVZOiBudW1iZXIgfCBudWxsOyAvLyB3aWxsIGJlIGRhdGUgdGltZXIgLSBkaXJ0eSBnbG9iYWxcbi8vIGZpbmQgb3V0IG1vc3QgcGVyZm9ybWFudCB3YXkgdG8gdGltZSB0aGlzLiBVc2luZyBkYXRlcyBvciB0aW1lcnMgb3IgcGVyZm9ybWFuY2Uubm93P1xubGV0IHRpbWVFbGFwc2VkOiBudW1iZXIgfCBudWxsOyAvLyB3aWxsIGJlIGRhdGUgdGltZXJcbmxldCBzZWxlY3RlZFJvdyA9IDA7IC8vIHJvdyBjdXJyZW50bHkgaGlnaGxpZ2h0ZWRcbmxldCB0cmFuc2xhdGVZID0gMDsgLy8gbW9kaWZpZXIgZm9yIFkgcG9zaXRpb24gb2YgZW50aXJlIGNhcm91c2VsLiBOb3RlIGluZGl2aWR1YWwgcm93cyBoYXZlIHRoZWlyIG93biB0cmFuc2xhdGUgdmFsdWVcbmxldCB0YXJnZXRUcmFuc2xhdGVZID0gMDsgLy8gdGFyZ2V0IHBvc2l0aW9uIGZvciBZIGFuaW1hdGlvbnMgd2hlbiByZWFjaGluZyBmaW5hbCBmcmFtZSBvZiBhbmltYXRpb24uXG5sZXQgdW5maW5pc2hlZE1vdmVtZW50WSA9IDA7IC8vIGlmIGEgbmV3IHkgYW5pbWF0aW9uIHN0YXJ0cyBiZWZvcmUgb3RoZXIgZmluaXNoZXMuIFVzZSB0aGlzIHRvIGNhbGN1bGF0ZSBob3cgbXVjaCBmdXJ0aGVyIHRoZSBzZWNvbmQgYW5pbWF0aW9uIG5lZWRzIHRvIGdvXG5sZXQgcHJldkRpcmVjdGlvbjogc3RyaW5nOyAvLyBUT0RPIC0gSEFDSyAtIHRoaXMgaXMgYSB0aHJvdHRsZSBvbiBzcGFtbWluZyB1cCBkb3duIGFzIGl0IGNhdXNlcyBhIGdsaXRjaCBzb21laG93XG5cbi8vIFRPRE8gTW92ZSB0aGlzIHRvIGhlbHBlciBmdW5jdGlvbnMuIElzIGN1cnJlbnRseSBkdXBsaWF0ZWQgaW4gcmVuZGVyQ2FyZHMuanNcbmNvbnN0IGFwcGx5VHJhbnNsYXRlID0gKHBvc2l0aW9uSW46IG51bWJlciwgdHJhbnNsYXRlSW46IG51bWJlcikgPT4ge1xuICAgIHJldHVybiBwb3NpdGlvbkluIC0gdHJhbnNsYXRlSW47XG59O1xuXG5jb25zdCBjbGVhckhvdmVyVGltZXIgPSAoKSA9PiB7XG4gICAgY2xlYXJUaW1lb3V0KGhvdmVyVGltZXIpO1xufTtcblxuLy8gcmV0dXJuIHRydWUgaWYgYW55IGFuaW1hdGlvbiB0aW1lcnMgZXhpc3RcbmNvbnN0IGlzQW5pbWF0aW5nID0gKCkgPT4ge1xuICAgIGxldCB2YWx1ZSA9IGZhbHNlO1xuICAgIGlmIChhbmltYXRpb25TdGFydFRpbWVZKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCBOVU1CRVJfT0ZfUk9XUzsgcm93KyspIHtcbiAgICAgICAgaWYgKHJvd3NEYXRhW3Jvd10/LmFuaW1hdGlvblN0YXJ0VGltZSkge1xuICAgICAgICAgICAgdmFsdWUgPSB0cnVlO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xufVxuXG5sZXQgcm93c0RhdGE6IEFycmF5PFJvd09iamVjdFR5cGU+ID0gW107XG5jb25zdCB2YWxpZEtleUNvZGVzID0gWzM3LCAzOCwgMzksIDQwXTtcblxuY29uc3Qgb25JbnRlcmFjdGlvbiA9IChldmVudDogS2V5Ym9hcmRFdmVudCkgPT4ge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgY29uc3QgeyBrZXlDb2RlIH0gPSBldmVudDtcbiAgICBpZiAoIXZhbGlkS2V5Q29kZXMuaW5jbHVkZXMoa2V5Q29kZSkpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2ludmFsaWQga2V5Y29kZScpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IHNlbGVjdGVkUm93T2JqZWN0ID0gcm93c0RhdGFbc2VsZWN0ZWRSb3ddO1xuXG4gICAgY2xlYXJIb3ZlclRpbWVyKCk7XG5cbiAgICBob3ZlclRpbWVyID0gd2luZG93LnNldFRpbWVvdXQoKCkgPT4ge1xuICAgIH0sIEhPVkVSX1RJTUVPVVQpO1xuXG4gICAgc3dpdGNoIChrZXlDb2RlKSB7XG4gICAgICAgIGNhc2UgMzc6IC8vIGxlZnRcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZFJvd09iamVjdC5oaWdobGlnaHRlZENhcmQgPiAwKSB7IC8vIGJvdW5kYXJ5IGNoZWNrXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dPYmplY3QuaGlnaGxpZ2h0ZWRDYXJkIC09IDE7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dPYmplY3QuYW5pbWF0aW9uU3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd09iamVjdC5hbmltYXRpb25EaXJlY3Rpb24gPSAnbGVmdCc7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dPYmplY3QudW5maW5pc2hlZE1vdmVtZW50WCA9IHNlbGVjdGVkUm93T2JqZWN0LnVuZmluaXNoZWRNb3ZlbWVudFggKyBzZWxlY3RlZFJvd09iamVjdC50YXJnZXRUcmFuc2xhdGVYIC0gc2VsZWN0ZWRSb3dPYmplY3QudHJhbnNsYXRlWDtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd09iamVjdC50YXJnZXRUcmFuc2xhdGVYID0gKHNlbGVjdGVkUm93T2JqZWN0LmhpZ2hsaWdodGVkQ2FyZCAqIFNJTkdMRV9NT1ZFX0RJU1RBTkNFX1gpO1xuICAgICAgICAgICAgICAgIGRyYXcoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgIGNhc2UgMzg6IC8vIHVwXG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRSb3cgPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHByZXZEaXJlY3Rpb24gPT09ICdkb3duJyAmJiB0aW1lRWxhcHNlZCAmJiB0aW1lRWxhcHNlZCA8IDE3NSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIGhhY2sgdG8gZml4IGEgZ2xpdGNoIHdoZW4gc3BhbW1pbmcgdXAgZG93bi4gTm8gaWRlYSB3aGF0IGNhdXNlcyBpdC5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3cgLT0gMTtcbiAgICAgICAgICAgICAgICBhbmltYXRpb25TdGFydFRpbWVZID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICB1bmZpbmlzaGVkTW92ZW1lbnRZID0gdW5maW5pc2hlZE1vdmVtZW50WSArIHRhcmdldFRyYW5zbGF0ZVkgLSB0cmFuc2xhdGVZO1xuICAgICAgICAgICAgICAgIHRhcmdldFRyYW5zbGF0ZVkgPSBzZWxlY3RlZFJvdyAqIFNJTkdMRV9NT1ZFX0RJU1RBTkNFX1k7XG4gICAgICAgICAgICAgICAgcHJldkRpcmVjdGlvbiA9ICd1cCc7XG4gICAgICAgICAgICAgICAgZHJhdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgY2FzZSAzOTogLy8gcmlnaHRcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZFJvd09iamVjdC5oaWdobGlnaHRlZENhcmQgPCBzZWxlY3RlZFJvd09iamVjdC5jYXJkcy5sZW5ndGggLSAxKSB7IC8vIGJvdW5kYXJ5IGNoZWNrXG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dPYmplY3QuaGlnaGxpZ2h0ZWRDYXJkICs9IDE7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dPYmplY3QuYW5pbWF0aW9uU3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICBzZWxlY3RlZFJvd09iamVjdC5hbmltYXRpb25EaXJlY3Rpb24gPSAncmlnaHQnO1xuICAgICAgICAgICAgICAgIHNlbGVjdGVkUm93T2JqZWN0LnVuZmluaXNoZWRNb3ZlbWVudFggPSBzZWxlY3RlZFJvd09iamVjdC51bmZpbmlzaGVkTW92ZW1lbnRYICsgc2VsZWN0ZWRSb3dPYmplY3QudGFyZ2V0VHJhbnNsYXRlWCAtIHNlbGVjdGVkUm93T2JqZWN0LnRyYW5zbGF0ZVg7XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3dPYmplY3QudGFyZ2V0VHJhbnNsYXRlWCA9IChzZWxlY3RlZFJvd09iamVjdC5oaWdobGlnaHRlZENhcmQgKiBTSU5HTEVfTU9WRV9ESVNUQU5DRV9YKTtcbiAgICAgICAgICAgICAgICBkcmF3KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICBjYXNlIDQwOiAvLyBkb3duXG4gICAgICAgICAgICBpZiAoc2VsZWN0ZWRSb3cgPCBOVU1CRVJfT0ZfUk9XUyAtIDEpIHtcbiAgICAgICAgICAgICAgICBpZiAocHJldkRpcmVjdGlvbiA9PT0gJ3VwJyAmJiB0aW1lRWxhcHNlZCAmJiB0aW1lRWxhcHNlZCA8IDE3NSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47IC8vIGhhY2sgdG8gZml4IGEgZ2xpdGNoIHdoZW4gc3BhbW1pbmcgdXAgZG93bi4gTm8gaWRlYSB3aGF0IGNhdXNlcyBpdC5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgc2VsZWN0ZWRSb3cgKz0gMTtcbiAgICAgICAgICAgICAgICBhbmltYXRpb25TdGFydFRpbWVZID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgICAgICB1bmZpbmlzaGVkTW92ZW1lbnRZID0gdW5maW5pc2hlZE1vdmVtZW50WSArIHRhcmdldFRyYW5zbGF0ZVkgLSB0cmFuc2xhdGVZO1xuICAgICAgICAgICAgICAgIHRhcmdldFRyYW5zbGF0ZVkgPSBzZWxlY3RlZFJvdyAqIFNJTkdMRV9NT1ZFX0RJU1RBTkNFX1k7XG4gICAgICAgICAgICAgICAgcHJldkRpcmVjdGlvbiA9ICdkb3duJztcbiAgICAgICAgICAgICAgICBkcmF3KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG59XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbkludGVyYWN0aW9uKTtcblxuXG5jb25zdCBzdGFydEltYWdlcyA9ICgpID0+IHtcbiAgICBjb25zdCBkZWZhdWx0SW1hZ2UgPSBnZXREZWZhdWx0SW1hZ2UoKTtcbiAgICBnZXRSb3dzRGF0YShkZWZhdWx0SW1hZ2UsIElNQUdFX1dJRFRILCBJTUFHRV9IRUlHSFQsIFBBRERJTkcgKS50aGVuKChyZXMpID0+IHtcbiAgICAgICAgcm93c0RhdGEgPSByZXM7XG4gICAgICAgIC8vIFRPRE8gdGhpcyBtdXRhdGVzIHJvd3NEYXRhIC0gZmluZCBhIHNlbnNpYmxlIHdheSBvZiBoYW5kbGluZyB0aGF0XG4gICAgICAgIHJvd3NEYXRhID0gbG9hZEFuZFJlbmRlckltYWdlcyhyZXMsIGN0eCwgdHJhbnNsYXRlWSk7XG4gICAgICAgIGRyYXcoKTtcbiAgICB9KTtcbn07XG5cbnN0YXJ0SW1hZ2VzKCk7XG5cbi8vIHRyYW5zbGF0ZSB2YWx1ZSBjaGFuZ2VzIHBvc2l0aW9uIG9mIGV2ZXJ5dGhpbmcgb24gcGFnZSBvbiBZIGF4aXNcbmNvbnN0IHVwZGF0ZVlQb3NpdGlvbiA9IChlYXNpbmc6IG51bWJlcikgPT4ge1xuICAgIGlmIChoaWdobGlnaHRDdXJyZW50UG9zaXRpb25ZID4gVEFSR0VUX1BPU0lUSU9OX1kpIHsgLy8gZG93blxuICAgICAgICB0cmFuc2xhdGVZID0gKHRhcmdldFRyYW5zbGF0ZVkgLSBTSU5HTEVfTU9WRV9ESVNUQU5DRV9ZKSArICgoU0lOR0xFX01PVkVfRElTVEFOQ0VfWSArIHVuZmluaXNoZWRNb3ZlbWVudFkpICogZWFzaW5nKTtcbiAgICB9XG4gICAgaWYgKGhpZ2hsaWdodEN1cnJlbnRQb3NpdGlvblkgPCBUQVJHRVRfUE9TSVRJT05fWSkgeyAvLyB1cFxuICAgICAgICB0cmFuc2xhdGVZID0gKHRhcmdldFRyYW5zbGF0ZVkgKyBTSU5HTEVfTU9WRV9ESVNUQU5DRV9ZKSAtICgoU0lOR0xFX01PVkVfRElTVEFOQ0VfWSAtIHVuZmluaXNoZWRNb3ZlbWVudFkpICogZWFzaW5nKTtcbiAgICB9XG59XG5cbi8vICBtYWluIHJlbmRlciBmdW5jdGlvbiAocmVjdXJzaXZlIGJhc2VkIHVwb24gYW5pbWF0aW9uU3RhcnRUaW1lWSlcbmNvbnN0IGRyYXcgPSAoKSA9PiB7XG4gICAgLy8gQ2xlYXIgY2FudmFzIGV2ZXJ5IHRpbWUgd2hlbiBmdW5jdGlvbiBpcyBjYWxsZWQgXG4gICAgLy8gVE9ETyBvcHRpbWlzYXRpb24gLSBvbmx5IGNsZWFyIHRoZSByb3dzIHRoYXQgYXJlIGFuaW1hdGluZz9cbiAgICBpZiAoY3R4KSB7XG4gICAgICAgIGNsZWFyUG9ydGFsKGN0eCk7XG4gICAgfVxuXG5cbiAgICAvLyB5IHBvc2l0aW9uIG9mIGhpZ2hsaWdodGVkIGNhcmRcbiAgICBoaWdobGlnaHRDdXJyZW50UG9zaXRpb25ZID0gTWF0aC5yb3VuZChhcHBseVRyYW5zbGF0ZSgoc2VsZWN0ZWRSb3cgKiBTSU5HTEVfTU9WRV9ESVNUQU5DRV9ZKSArIFRBUkdFVF9QT1NJVElPTl9ZICsgdW5maW5pc2hlZE1vdmVtZW50WSwgdHJhbnNsYXRlWSkpO1xuXG4gICAgLy8gaGFuZGxlIHkgcGFydCBvZiBhbmltYXRpb24gLSBUT0RPIGdldCByaWQgb2YgdGhlIGhvcnJpYmxlIHVzZSBvZiBnbG9iYWxzIGZvciB5IGFuaW1hdGlvbiBhbmQgbW92ZSB0aGlzIHRvIGFub3RoZXIgZmlsZVxuICAgIGlmIChhbmltYXRpb25TdGFydFRpbWVZKSB7IC8vIFRPRE8gZG9lcyB0aGlzIGFwcHJvYWNoIG1pc3Mgb3V0IHRoZSBsYXN0IGZyYW1lIG9mIHRoZSBhbmltYXRpb25cbiAgICAgICAgY29uc3QgdGltZU5vdyA9IERhdGUubm93KCk7XG4gICAgICAgIHRpbWVFbGFwc2VkID0gdGltZU5vdyAtIGFuaW1hdGlvblN0YXJ0VGltZVk7XG4gICAgICAgIC8vIGhvdyBmYXIgdGhlIGFuaW1hdGlvbiBpcyB0aHJvdWdoIGZyb20gc3RhcnQgdG8gZmluaXNoIChiZXR3ZWVuIDAgYW5kIDEpXG4gICAgICAgIGxldCBhbmltYXRpb25Qb3NpdGlvbiA9IHRpbWVFbGFwc2VkIC8gQU5JTUFUSU9OX0RVUkFUSU9OO1xuICAgICAgICAvLyAqKioqKiBZIEFOSU1BVElPTiBFTkRJTkcgICoqKioqKiAgXG4gICAgICAgIGlmICh0aW1lRWxhcHNlZCA+IEFOSU1BVElPTl9EVVJBVElPTiB8fCBhbmltYXRpb25Qb3NpdGlvbiA+IDEpIHtcbiAgICAgICAgICAgIGFuaW1hdGlvblBvc2l0aW9uID0gMTsgLy8gZW5zdXJlIGZpbmFsIG51bWJlciAxIHJhdGhlciB0aGFuIG5lYXJseSAxXG4gICAgICAgICAgICBhbmltYXRpb25TdGFydFRpbWVZID0gbnVsbDtcbiAgICAgICAgICAgIHNjYWxpbmdBbmltYXRpb25Qcm9ncmVzc2lvbiA9IDE7XG4gICAgICAgICAgICB1cGRhdGVZUG9zaXRpb24oMSk7XG4gICAgICAgICAgICB0aW1lRWxhcHNlZCA9IG51bGw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyAqKioqKiBVUERBVEUgUE9TSVRJT04gQU5JTUFUSU9OICoqKioqKlxuICAgICAgICAgICAgLy8gYW5pbWF0aW9uIFBvc2l0aW9uIGlzIGEgbGluZWFyIHBvc2l0aW9uIGJldHdlZW4gMCBhbmQgMSBiYXNlZCB1cG9uIHRpbWUgYmV0d2VlbiAwIGFuZCBlbmQgb2YgdGhlIGFuaW1hdGlvbiBkdXJhdGlvbi5cbiAgICAgICAgICAgIC8vIGVhc2luZyBhbGdvcml0aG0gbW9kaWZpZXMgdGhpcyB2YWx1ZSB0byBjcmVhdGUgYSBjdXJ2ZSByYXRoZXIgdGhhbiBhIHN0cmFpZ2h0IGxpbmVcbiAgICAgICAgICAgIGNvbnN0IGVhc2luZ1Bvc2l0aW9uID0gZWFzZU91dFF1aW50KGFuaW1hdGlvblBvc2l0aW9uKTtcbiAgICAgICAgICAgIHNjYWxpbmdBbmltYXRpb25Qcm9ncmVzc2lvbiA9IGVhc2luZ1Bvc2l0aW9uO1xuICAgICAgICAgICAgdXBkYXRlWVBvc2l0aW9uKGVhc2luZ1Bvc2l0aW9uKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjdHgpIHtcbiAgICAgICAgcmVuZGVyQ2FyZHMoY3R4LCByb3dzRGF0YSwgc2VsZWN0ZWRSb3csIHVuZmluaXNoZWRNb3ZlbWVudFksIHRyYW5zbGF0ZVksIGFuaW1hdGlvblN0YXJ0VGltZVkhLCBzY2FsaW5nQW5pbWF0aW9uUHJvZ3Jlc3Npb24pO1xuICAgIH1cbiAgICBcblxuICAgIC8vIHNob3dzIHRoZSBvdXRsaW5lIG9mIHRoZSB2aXNpYmxlIHBhZ2Ugb24gYSBkZXZpY2Ugd2l0aCBhIGxvY2tlZCBhc3BlY3QgcmF0aW9cbiAgICBpZiAoREVCVUcgJiYgY3R4KSB7XG4gICAgICAgIGRyYXdDYW52YXNCb3JkZXIoY3R4KTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGlzQW5pbWF0aW5nKCkpIHtcblxuICAgICAgICBpZiAoVVNFX1JFUVVFU1RfQU5JTUFUSU9OX0ZSQU1FKSB7XG4gICAgICAgICAgICAvLyBUT0RPIGNoZWNrIGlmIG11bHRpcGxlIGFuaW1hdGlvbnMgYXJlIGNhbGxpbmcgZHJhdyB3aGljaCByZWN1cnNpdmVseSBjYWxscyBpdHNlbGYsIHBvdGVudGlhbGx5IGNyZWF0aW5nIGNvbmN1cnJlbnQgbG9vcHNcbiAgICAgICAgICAgIC8vICBsb29rIGF0IHBhc3NpbmcgYW4gSUQgdG8gZHJhdyBmdW5jdGlvbiB0byByZW1lZHkgdGhpcyBpZiBpdCdzIGEgcHJvYmxlbVxuICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShkcmF3KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBkcmF3KCk7XG4gICAgICAgICAgICB9LCBGUkFNRV9SQVRFKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuY29uc3Qgb25SZXNpemVXaW5kb3cgPSAoKSA9PiB7XG4gICAgcmVzaXplZFdpbmRvdyh3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0KVxuICAgIGNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XG4gICAgY2FudmFzLndpZHRoID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgaWYgKCFhbmltYXRpb25TdGFydFRpbWVZKSB7XG4gICAgICAgIGFuaW1hdGlvblN0YXJ0VGltZVkgPSAxMDA7XG4gICAgICAgIGRyYXcoKTtcbiAgICB9XG59O1xuXG53aW5kb3cub25yZXNpemUgPSBvblJlc2l6ZVdpbmRvdztcbm9uUmVzaXplV2luZG93KCk7XG5cbiJdLCJuYW1lcyI6WyJXSURUSCIsIkFOSU1BVElPTl9EVVJBVElPTiIsIklNQUdFX1dJRFRIIiwiSU1BR0VfSEVJR0hUIiwiVEFSR0VUX1BPU0lUSU9OX1giLCJUQVJHRVRfUE9TSVRJT05fWSIsIlNJTkdMRV9NT1ZFX0RJU1RBTkNFX1giLCJTSU5HTEVfTU9WRV9ESVNUQU5DRV9ZIiwicG9ydGFsV2lkdGgiLCJwb3J0YWxIZWlnaHQiLCJhcHBseVRyYW5zbGF0ZSIsInBvc2l0aW9uSW4iLCJ0cmFuc2xhdGVJbiIsImRyYXdTY2FsZWRGb2N1c0hpZ2hsaWdodCIsImN0eCIsImhpZ2hsaWdodGVkWEluIiwiaGlnaGxpZ2h0ZWRZSW4iLCJpbWFnZVNjYWxpbmciLCJ4T2Zmc2V0IiwieU9mZnNldCIsImxpbmVXaWR0aCIsInN0cm9rZVN0eWxlIiwiYmVnaW5QYXRoIiwicmVjdCIsImFwcGx5UG9ydGFsU2NhbGluZyIsInN0cm9rZSIsInNob3VsZFJlbmRlciIsInhMZWZ0IiwieFJpZ2h0IiwieVRvcCIsInlCb3R0b20iLCJnZXRBbHBoYSIsInhQb3MiLCJnZXRMZWZ0QWxwaGEiLCJnZXRSaWdodEFscGhhIiwiTWF0aCIsIm1heCIsImRyYXdTY2FsZWRJbWFnZSIsImltYWdlIiwieVBvcyIsIndpZHRoIiwiaGVpZ2h0IiwiZHJhd0ltYWdlIiwidmFsdWUiLCJhdXRoS2V5IiwiZ2VucmVzIiwiZ2V0UmFuZG9tR2VucmUiLCJzcGxpY2UiLCJmbG9vciIsInJhbmRvbSIsImxlbmd0aCIsImdldFJvd3NEYXRhIiwiZGVmYXVsdEltYWdlIiwiUEFERElORyIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZmV0Y2giLCJtZXRob2QiLCJ0aGVuIiwicmVzcG9uc2UiLCJvayIsImpzb24iLCJyZXMiLCJpbnRpYWxSb3dzIiwidGhlUm93c0RhdGEiLCJwdXNoIiwicm93Q291bnRlciIsImZvckVhY2giLCJyb3dJbiIsImdlbnJlSWQiLCJpZCIsInVybCIsInJlc3VsdHMiLCJjYXJkcyIsIm1hcCIsImNhcmQiLCJjYXJkSW5kZXgiLCJvcmlnaW5hbF90aXRsZSIsIm92ZXJ2aWV3IiwiYmFja2Ryb3BfcGF0aCIsInBvc3Rlcl9wYXRoIiwicmVsZWFzZV9kYXRlIiwiY2FyZE9yaWdpbmFsUG9zaXRpb25YIiwiY2FyZE9yaWdpbmFsUG9zaXRpb25ZIiwicm93Iiwicm93TnVtYmVyIiwiaGlnaGxpZ2h0ZWRDYXJkIiwidHJhbnNsYXRlWCIsImFuaW1hdGlvblN0YXJ0VGltZSIsImFuaW1hdGlvbkRpcmVjdGlvbiIsInRhcmdldFRyYW5zbGF0ZVgiLCJlYXNpbmdQb3NpdGlvbiIsInVuZmluaXNoZWRNb3ZlbWVudFgiLCJjYW52YXMiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZ2V0Q29udGV4dCIsImhvdmVyVGltZXIiLCJhbmltYXRpb25TdGFydFRpbWVZIiwidGltZUVsYXBzZWQiLCJwcmV2RGlyZWN0aW9uIiwiaGlnaGxpZ2h0Q3VycmVudFBvc2l0aW9uWSIsInNjYWxpbmdBbmltYXRpb25Qcm9ncmVzc2lvbiIsInNlbGVjdGVkUm93IiwidHJhbnNsYXRlWSIsInRhcmdldFRyYW5zbGF0ZVkiLCJ1bmZpbmlzaGVkTW92ZW1lbnRZIiwicm93c0RhdGEiLCJ2YWxpZEtleUNvZGVzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwicHJldmVudERlZmF1bHQiLCJrZXlDb2RlIiwiaW5jbHVkZXMiLCJjb25zb2xlIiwibG9nIiwic2VsZWN0ZWRSb3dPYmplY3QiLCJjbGVhclRpbWVvdXQiLCJ3aW5kb3ciLCJzZXRUaW1lb3V0IiwiRGF0ZSIsIm5vdyIsImRyYXciLCJOVU1CRVJfT0ZfUk9XUyIsIkltYWdlIiwic3JjIiwiZ2V0RGVmYXVsdEltYWdlIiwicm93TnVtIiwiaW1hZ2VOdW0iLCJmdWxsSW1hZ2VVcmwiLCJpbWFnZVVybCIsImltZyIsIm9ubG9hZCIsIm9uZXJyb3IiLCJFcnJvciIsImlzSGlnaGxpZ2h0ZWRJbWFnZSIsImFscGhhIiwiZ2xvYmFsQWxwaGEiLCJkcmF3U2NhbGVkQ2FyZCIsImxvYWRBbmRSZW5kZXJJbWFnZXMiLCJzdGFydEltYWdlcyIsInVwZGF0ZVlQb3NpdGlvbiIsImVhc2luZyIsImRlbHRhIiwiY2xlYXJSZWN0IiwiY2xlYXJQb3J0YWwiLCJyb3VuZCIsInRpbWVOb3ciLCJhbmltYXRpb25Qb3NpdGlvbiIsInBvdyIsImRyYXdTZWxlY3RlZENhcmRMYXN0Iiwicm93T2JqZWN0IiwidGltZUVsYXBzZWRYIiwibWluIiwiY2FyZE9iamVjdCIsInNjYWxpbmdQcm9ncmVzc2lvbiIsInJlbmRlckNhcmRzIiwiZHJhd0NhbnZhc0JvcmRlciIsImlzQW5pbWF0aW5nIiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwib25SZXNpemVXaW5kb3ciLCJ3aWR0aEluIiwiaGVpZ2h0SW4iLCJpbm5lcldpZHRoIiwiaW5uZXJIZWlnaHQiLCJvbnJlc2l6ZSJdLCJzb3VyY2VSb290IjoiIn0=